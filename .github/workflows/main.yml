name: CI-xClass

on:
    push:
        branches: [ master ]
    pull_request:
        branches: [ master ]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v2
            -   name: Set up JDK 1.8
                uses: actions/setup-java@v1
                with:
                    java-version: 1.8
            -   name: Build with Maven
                run: mvn -B package --file pom.xml
            -   name: test
                env:
                    privateKey: ${{secrets.PRIVATEKEY}}
                    knownHosts: ${{secrets.KNOWNHOSTS}}
                    user:       ${{secrets.USER}}
                    host:       ${{secrets.HOST}}
                    port:       ${{secrets.PORT}}
                    target:     ${{secrets.TARGET}}
                run:  |
                      mkdir -p ~/.ssh/
                      echo "$privateKey" > ~/.ssh/private.key
                      chmod 600 ~/.ssh/private.key
                      echo "$knownHosts" > ~/.ssh/known_hosts
                      scp -P $port -i ~/.ssh/private.key /home/runner/work/xClass/xClass/target/xclass-0.0.1-SNAPSHOT.jar $user@$host:/xClass/app/
                      ssh -p $port -i ~/.ssh/private.key $user@$host hostname;date














#                      ping $host -c 9
#                      echo "ssh-keygen"
#                      ssh-keygen -y -e -f ~/.ssh/private.key
#                      echo "ssh-keyscan"
#                      ssh-keyscan 140.238.155.2
#                          echo ${{secrets.KNOWNHOSTS}} > ~/.ssh/known_hosts

#                                        echo ${{secrets.PRIVATEKEY}} > ~/.ssh/private.key
#    ssh -i ./ycz.log -p 50022 -o "StrictHostKeyChecking no" root@xclass.highspeed.vip hostname
